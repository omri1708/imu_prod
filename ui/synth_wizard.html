<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>IMU Synth Wizard</title>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<style>
body{font-family:system-ui,sans-serif;background:#0b1020;color:#e6edf3;margin:0}
header{padding:10px 14px;background:#11162a;border-bottom:1px solid #1f2a44;display:flex;gap:10px;align-items:center}
.badge{background:#243152;border:1px solid #355;color:#9fb7ff;border-radius:999px;padding:2px 8px;font-size:12px}
main{display:grid;grid-template-columns:420px 1fr;gap:12px;padding:12px}
.card{background:#12172d;border:1px solid #233259;border-radius:10px;padding:12px}
label{display:block;font-size:12px;color:#9fb7ff}
input,select,textarea,button{background:#0e1630;border:1px solid #233259;color:#e6edf3;border-radius:8px;padding:6px 8px}
textarea{width:100%;height:260px;font-family:ui-monospace,menlo,consolas,monospace}
pre{background:#0e1630;border:1px solid #233259;border-radius:8px;padding:8px;overflow:auto}
table{width:100%;border-collapse:collapse}
th,td{border-bottom:1px solid #233259;padding:6px 8px;font-size:12px}
</style>
</head>
<body>
<header>
  <strong>IMU Synth Wizard</strong>
  <a class="badge" href="/ui/index.html" style="text-decoration:none">home</a>
  <span class="badge" id="info">ready</span>
</header>
<main>
  <div class="card">
    <h3>Preset</h3>
    <select id="preset"></select>
    <button id="btn_load">Load</button>
    <h3 style="margin-top:16px">Spec (JSON)</h3>
    <textarea id="spec"></textarea>
    <div style="margin-top:8px">
      <button id="btn_create">Create Adapter</button>
      <button id="btn_reload">Reload Registry</button>
    </div>
    <pre id="out"></pre>
  </div>
  <div class="card">
    <h3>Dry-Run test</h3>
    <label>kind</label><input id="kind"/>
    <label>params (JSON)</label><textarea id="params">{}</textarea>
    <button id="btn_dry">Dry-Run</button>
    <pre id="out_dry"></pre>
    <h3>Registered kinds</h3>
    <button id="btn_list">Refresh</button>
    <pre id="kinds"></pre>
  </div>
</main>
<script>
const $=s=>document.querySelector(s);
async function api(p,m='GET',b=null){ const r=await fetch(p,{method:m,headers:{'content-type':'application/json'},body:b?JSON.stringify(b):null}); const j=await r.json(); if(!r.ok) throw new Error(j.detail||JSON.stringify(j)); return j; }

async function loadPresets(){
  const j=await api('/synth/presets/keys');
  const sel=$("#preset"); sel.innerHTML='';
  (j.keys||[]).forEach(k=>{ const o=document.createElement('option'); o.textContent=k; sel.appendChild(o); });
}
$("#btn_load").onclick=async()=>{
  const k=$("#preset").value; const j=await api('/synth/presets/get?key='+encodeURIComponent(k));
  $("#spec").value = JSON.stringify(j.spec, null, 2);
  $("#kind").value = j.spec.kind;
  $("#params").value = JSON.stringify(j.spec.examples || {}, null, 2);
  $("#info").textContent = 'preset loaded: '+k;
};
$("#btn_create").onclick=async()=>{
  try{
    const spec=JSON.parse($("#spec").value);
    const j=await api('/synth/adapter/create','POST',spec);
    $("#out").textContent = JSON.stringify(j,null,2);
  }catch(e){ $("#out").textContent = String(e); }
};
$("#btn_reload").onclick=async()=>{ const j=await api('/synth/adapter/reload','POST',{}); $("#out").textContent=JSON.stringify(j,null,2); };
$("#btn_list").onclick=async()=>{ const j=await api('/synth/adapter/list'); $("#kinds").textContent=JSON.stringify(j,null,2); };
$("#btn_dry").onclick=async()=>{
  try{
    const kind=$("#kind").value; const params=JSON.parse($("#params").value||"{}");
    const j=await api('/adapters/dry_run','POST',{"user_id":"demo-user","kind":kind,"params":params});
    $("#out_dry").textContent=JSON.stringify(j,null,2);
  }catch(e){ $("#out_dry").textContent=String(e); }
};
loadPresets();
</script>
</body>
</html>